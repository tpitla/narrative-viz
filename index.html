<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style>
    circle {
        fill-opacity: .75;
    }
    body {
        margin: 0px;
      }
      .tick {
        font-size: 22;
      }
      .axis-label {
        fill: black;
        font-size: 20;
        font-family: sans-serif;
      }
</style>

<body onload='init()'>
    <!-- <button class="w3-button w3-display-left" onclick="plusDivs(-1)">&#10094;</button> -->
    <svg>
    </svg>
    
    <!-- <button class="w3-button w3-display-right" onclick="plusDivs(+1)">&#10095;</button> -->
    <script>
        async function init() {
            const data = await d3.csv("https://raw.githubusercontent.com/tpitla/tpitla.github.io/master/cars2017.csv");
            const data2 = await d3.csv("https://raw.githubusercontent.com/tpitla/tpitla.github.io/master/2020.csv");
            //console.log(data2)
            console.log(data2['Healthy life expectancy'])

            var width = window.screen.availWidth*.70; // Width of the SVG element
            var height = window.screen.availHeight*.70; // Height of the SVG element
            var margin = window.screen.availHeight*.10; // Margin that will be used inside the SVG element
            const innerWidth = width - margin;
            const innerHeight = height - margin;

            var x = d3.scaleLinear().domain([2, 8]).range([0, width]);
            var y = d3.scaleLinear().domain([40, 80]).range([height, 0])
            var r = d3.scaleLinear().domain([0, 1]).range([2, 60])
            var color = d3.scaleOrdinal(d3.schemeCategory10);

            var svg = d3.select("svg")
                .attr("width", width + 2 * margin)
                .attr("height", height + 2 * margin)
                .append("g")
                .attr("transform", "translate(" + margin + "," + margin + ")")
                .selectAll("circle")
                .data(data2)
                .enter()
                .append("circle")
                .attr("cx", function (d, i) { return x(d['Ladder score']); })
                .attr("cy", function (d, i) { return y(d['Healthy life expectancy']); })
                .attr("r", function (d, i) { return r(parseFloat(d['Freedom to make life choices'])); })
                .style("fill", function(d) {return color(d["Regional indicator"]);})

            d3.select("svg").append("g")
                .attr("transform", "translate(" + margin + "," + margin + ")")
                .call(d3.axisLeft(y).tickValues([40, 50, 60, 70, 80]).tickFormat(d3.format("~s")))
                .append("text")
                .attr('class', 'axis-label')
                .attr('x', -innerHeight / 1.8)
                .attr('y', -60)
                .attr('transform', `rotate(-90)`)
                .style('text-anchor', 'middle')
                .text("Life Expectancy");


            d3.select("svg").append("g")
                .attr("transform", "translate(" + margin + "," + (height + margin) + ")")
                .call(d3.axisBottom(x).tickValues([2, 4, 6, 8]).tickFormat(d3.format("~s")))
                .append("text")
                .attr('class', 'axis-label')
                .attr('x', innerWidth / 1.8)
                .attr('y', 100)
                .text("Happiness Score");


            var legend = svg.selectAll(".legend")
            .data(color.domain())
            .enter().append("g")
            .classed("legend", true)
            .attr("transform", function(d, i) {
                console.log(d);
                return "translate(0," + i * 20 + ")";
            });

            legend.append("rect")
            .attr("x", width/2 - 10)
            .attr("width", 12)
            .attr("height", 12)
            .style("fill", color);

            legend.append("text")
            .attr("x", width/2 - 26)
            .attr("dy", ".65em")
            .text(function(d) {
            return d;
        }
        );

        }
    </script>
</body>

</html>