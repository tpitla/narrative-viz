<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<script src="d3-tip.js"></script>

<style>

    circle {
        fill-opacity: .60;
    }

    body {
        margin: 0px;
    }

    .tick {
        font-size: 18;
    }

    .axis-label {
        fill: black;
        font-size: 20;
        font-family: sans-serif;
    }

    .d3-tip {
      color: #fff;
      border-radius: 4px;
      font-size: 16px;
      line-height: 1;
      padding: 8px;
      background: rgba(0, 0, 0, 0.7);

    }

    .grid line {
    stroke: lightgrey;
    stroke-opacity: 0.6;
    shape-rendering: crispEdges;
    }

    .grid path {
    stroke-width: 0;
    }
</style>

<body onload='init()'>
    <!-- <button class="w3-button w3-display-left" onclick="plusDivs(-1)">&#10094;</button> -->
    <svg>
    </svg>
    
    <!-- <button class="w3-button w3-display-right" onclick="plusDivs(+1)">&#10095;</button> -->
    <script>
        async function init() {
            const data = await d3.csv("https://raw.githubusercontent.com/tpitla/tpitla.github.io/master/cars2017.csv");
            const data2 = await d3.csv("https://raw.githubusercontent.com/tpitla/tpitla.github.io/master/2020.csv");
            //console.log(data2)
            console.log(data2['Healthy life expectancy'])

            var width = window.screen.availWidth*.45; // Width of the SVG element
            var height = window.screen.availHeight*.45; // Height of the SVG element
            var margin = window.screen.availHeight*.10; // Margin that will be used inside the SVG element
            const innerWidth = width - margin;
            const innerHeight = height - margin;

            var x = d3.scaleLinear().domain([1.9, 8]).range([0, width]);
            var y = d3.scaleLinear().domain([39, 80]).range([height, 0])
            var r = d3.scaleLinear().domain([0.35, 1]).range([6, 20])
            var color = d3.scaleOrdinal(d3.schemeCategory10);

            // Create Tooltips
            var tip = d3.tip().attr('class', 'd3-tip').direction('e').offset([0,5])
            .html(function(d) {
                var content = "";
                content +=                  
                    'Country Name: ' + 
                    d['Country name'] +
                    "<br/>"  +
                    'Happiness Score: ' + 
                    d['Ladder score'] +
                    "<br/>"  +
                    'Life expectancy: ' + 
                    d['Healthy life expectancy'] +
                    "<br/>"  +
                    'Freedom to make life choices: ' + 
                    d['Freedom to make life choices'] +
                    "<br/>";
                return content;
            });

            d3.select("svg")
                .attr("width", width *2 + 2 * margin)
                .attr("height", height*2 + 2 * margin)
                .append("g")
                .attr("transform", "translate(" + margin + "," + margin + ")")
                .call(tip)
                .selectAll("circle")
                .data(data2)
                .enter()
                .append("circle")
                .attr("cx", function (d, i) { return x(d['Ladder score']); })
                .attr("cy", function (d, i) { return y(d['Healthy life expectancy']); })
                .attr("r", function (d, i) { return r(parseFloat(d['Freedom to make life choices'])); })
                //.attr("r", function (d, i) { return parseInt(1) + 20; })
                .style("fill", function(d) {return color(d["Regional indicator"]);})
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide);

            d3.select("svg").append("g")
                .attr("class", "grid")
                .attr("transform", "translate(" + margin + "," + margin + ")")
                .call(d3.axisLeft(y).tickValues([40, 50, 60, 70, 80]).tickSize(-width).tickFormat(d3.format("~s")))
                .append("text")
                .attr('class', 'axis-label')
                .attr('x', -innerHeight / 1.8)
                .attr('y', -60)
                .attr('transform', `rotate(-90)`)
                .style('text-anchor', 'middle')
                .text("Life Expectancy");


            d3.select("svg").append("g")
                .attr("class", "grid")
                .attr("transform", "translate(" + margin + "," + (height + margin) + ")")
                .call(d3.axisBottom(x).tickValues([2, 4, 6, 8]).tickSize(-height).tickFormat(d3.format("~s")))
                .append("text")
                .attr('class', 'axis-label')
                .attr('x', innerWidth / 1.8)
                .attr('y', 100)
                .text("Happiness Score");


            var legend = d3.select("svg").selectAll(".legend")
            .data(color.domain())
            .enter().append("g")
            .classed("legend", true)
            .attr("transform", function(d, i) {
                return "translate(0," + i * 20 + ")";
            });

            legend.append("rect")
            .attr("x", 1.15*width)
            .attr("y", .95*height )
            .attr("width", 15)
            .attr("height", 15)
            .style("fill", color)
            .style("fill-opacity", 0.60);

            legend.append("text")
            .attr("x", 1.15* width + 25)
            .attr("y", .95*height)
            .attr("dy", ".70em")
            .text(function(d) {
            return d;}
            );
        }
    </script>
</body>

</html>